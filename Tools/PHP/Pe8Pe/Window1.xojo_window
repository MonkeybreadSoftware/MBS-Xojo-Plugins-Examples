#tag Window
Begin Window Window1
   BackColor       =   &cDADADA00
   Backdrop        =   0
   BalloonHelp     =   ""
   CloseButton     =   True
   Composite       =   True
   Frame           =   0
   FullScreen      =   False
   HasBackColor    =   True
   HasFullScreenButton=   False
   Height          =   338
   ImplicitInstance=   True
   LiveResize      =   "False"
   MacProcID       =   0
   MaxHeight       =   32000
   MaximizeButton  =   True
   MaxWidth        =   32000
   MenuBar         =   -1023586073
   MenuBarVisible  =   True
   MinHeight       =   64
   MinimizeButton  =   True
   MinWidth        =   64
   Placement       =   0
   Resizeable      =   True
   Title           =   "Pe8Pe v0.1"
   Visible         =   True
   Width           =   443
   Begin Rectangle Rectangle1
      AutoDeactivate  =   True
      BorderWidth     =   1.0
      BottomRightColor=   
      Enabled         =   True
      FillColor       =   
      Height          =   218
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Left            =   514
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   False
      LockTop         =   False
      Scope           =   "0"
      TabIndex        =   0
      TabPanelIndex   =   0
      TabStop         =   True
      Top             =   77
      TopLeftColor    =   
      Transparent     =   True
      Visible         =   False
      Width           =   155
      Begin TextArea hrefsearchpattern
         AcceptTabs      =   False
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   &cFFFFFF00
         Bold            =   False
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "Rectangle1"
         Italic          =   False
         Left            =   526
         LimitText       =   0
         LineHeight      =   0.0
         LineSpacing     =   1.0
         LockBottom      =   False
         LockedInPosition=   False
         LockLeft        =   False
         LockRight       =   False
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   False
         Scope           =   "0"
         ScrollbarHorizontal=   False
         ScrollbarVertical=   True
         Styled          =   False
         TabIndex        =   0
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "window.location.href='(.+)'|window.location.href=""(.+)"""
         TextColor       =   
         TextFont        =   "System"
         TextSize        =   0.0
         TextUnit        =   0
         Top             =   149
         Transparent     =   True
         Underline       =   False
         UnicodeMode     =   0
         UseFocusRing    =   True
         Visible         =   False
         Width           =   80
      End
      Begin TextArea hrefreplacehpattern
         AcceptTabs      =   False
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   &cFFFFFF00
         Bold            =   False
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "Rectangle1"
         Italic          =   False
         Left            =   526
         LimitText       =   0
         LineHeight      =   0.0
         LineSpacing     =   1.0
         LockBottom      =   False
         LockedInPosition=   False
         LockLeft        =   False
         LockRight       =   False
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   False
         Scope           =   "0"
         ScrollbarHorizontal=   False
         ScrollbarVertical=   True
         Styled          =   False
         TabIndex        =   1
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "Pe8Pe.Navigate('\\1')"
         TextColor       =   
         TextFont        =   "System"
         TextSize        =   0.0
         TextUnit        =   0
         Top             =   183
         Transparent     =   True
         Underline       =   False
         UnicodeMode     =   0
         UseFocusRing    =   True
         Visible         =   False
         Width           =   80
      End
      Begin TextArea hrefsearchpattern2
         AcceptTabs      =   False
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   &cFFFFFF00
         Bold            =   False
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "Rectangle1"
         Italic          =   False
         Left            =   526
         LimitText       =   0
         LineHeight      =   0.0
         LineSpacing     =   1.0
         LockBottom      =   False
         LockedInPosition=   False
         LockLeft        =   False
         LockRight       =   False
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   False
         Scope           =   "0"
         ScrollbarHorizontal=   False
         ScrollbarVertical=   True
         Styled          =   False
         TabIndex        =   2
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "href=""(.+)"""
         TextColor       =   
         TextFont        =   "System"
         TextSize        =   0.0
         TextUnit        =   0
         Top             =   223
         Transparent     =   True
         Underline       =   False
         UnicodeMode     =   0
         UseFocusRing    =   True
         Visible         =   False
         Width           =   80
      End
      Begin TextArea hrefreplacehpattern2
         AcceptTabs      =   False
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   &cFFFFFF00
         Bold            =   False
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "Rectangle1"
         Italic          =   False
         Left            =   526
         LimitText       =   0
         LineHeight      =   0.0
         LineSpacing     =   1.0
         LockBottom      =   False
         LockedInPosition=   False
         LockLeft        =   False
         LockRight       =   False
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   False
         Scope           =   "0"
         ScrollbarHorizontal=   False
         ScrollbarVertical=   True
         Styled          =   False
         TabIndex        =   3
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "href=""#"" onclick=""Pe8Pe.Navigate('\\1');"""
         TextColor       =   
         TextFont        =   "System"
         TextSize        =   0.0
         TextUnit        =   0
         Top             =   257
         Transparent     =   True
         Underline       =   False
         UnicodeMode     =   0
         UseFocusRing    =   True
         Visible         =   False
         Width           =   80
      End
      Begin Label StaticText1
         AutoDeactivate  =   True
         Bold            =   False
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   58
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "Rectangle1"
         Italic          =   False
         Left            =   518
         LockBottom      =   False
         LockedInPosition=   False
         LockLeft        =   False
         LockRight       =   False
         LockTop         =   False
         Multiline       =   True
         Scope           =   "0"
         Selectable      =   False
         TabIndex        =   4
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "This is used to later replace anchor href and onclick events that can contain window.location.href to use an ScriptCallBack event ..."
         TextAlign       =   0
         TextColor       =   
         TextFont        =   "System"
         TextSize        =   9.0
         TextUnit        =   0
         Top             =   81
         Transparent     =   False
         Underline       =   False
         Visible         =   False
         Width           =   144
      End
   End
   Begin HTMLViewer HTMLViewer1
      AutoDeactivate  =   True
      Enabled         =   True
      Height          =   318
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Left            =   0
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   True
      LockTop         =   True
      Renderer        =   0
      Scope           =   "0"
      TabIndex        =   0
      TabPanelIndex   =   0
      TabStop         =   True
      Top             =   0
      Transparent     =   True
      Visible         =   True
      Width           =   443
   End
End
#tag EndWindow

#tag WindowCode
	#tag Event
		Sub Close()
		  Quit()
		End Sub
	#tag EndEvent

	#tag Event
		Function ContextualMenuAction(hitItem as MenuItem) As Boolean
		  If hitItem.Index=100001 Then
		    App.CurrentDocumentsFolderPath="documents/"
		    LoadPHPCode("index.php")
		  End If
		End Function
	#tag EndEvent

	#tag Event
		Sub Open()
		  p=new MYPHP
		  rex=New RegExMBS
		  rex.CompileOptionMultiline=True
		  
		  htmlEvents = new MyFrameEvents
		  HTMLViewer1.InstallWebFrameLoadDelegateMBS htmlEvents
		  
		  Dim f As FolderItem
		  Dim fullpath As String
		  f = New FolderItem(App.CurrentDocumentsFolderPath+"/index.php")
		  fullpath = f.ShellPath
		  f=Nil
		  f = GetFolderItem(fullpath, FolderItem.PathTypeShell)
		  if f=Nil Or f.Exists=False Then
		    MsgBox "No index.php found. Application will quit now."
		    Quit()
		  End If
		  If TargetMacOS Or TargetCocoa Or TargetCarbon Or TargetMachO Then
		    p.setVariable("RBCurrentOS","0") ' Mac 
		  ElseIf TargetWin32 Then
		    p.setVariable("RBCurrentOS","1") ' Windows
		  ElseIf TargetLinux Then
		       p.setVariable("RBCurrentOS","2") ' Linux
		  End if
		  p.setVariable("RBCurrentPath",Replace(f.ShellPath,"/index.php",""))
		  HTMLViewer1.LoadHTMLStringMBS("","")
		  f=Nil
		  'If p.LoadLibrary("mysql") = False Then
		  'MsgBox "Cannot load MySQL Module"
		  'End If
		  
		  
		  
		End Sub
	#tag EndEvent


	#tag Method, Flags = &h0
		Sub LoadPHPCode(URL As String)
		  if App.HTMLResultLoaded = False Then
		    App.HTMLResultLoaded=True
		    HTMLViewer1.StopLoadingMBS
		    Dim f As FolderItem
		    Dim t As TextInputStream
		    Dim loadhtml As Boolean = False
		    Dim fullpath As String = ""
		    Dim isPHPFile As Boolean = False
		    Dim isHTMLFile As Boolean = False
		    Dim isFileURL As Boolean = False
		    if URL.InStr("http://")>0 Or URL.InStr("https://")>0 Then
		      HTMLViewer1.LoadURLMBS(URL)
		      Return
		    End If
		    If URL.InStr(0,".php")>0 Then //PHP FILE
		      isPHPFile = True
		    ElseIf URL.InStr(0,".html")>0 Or URL.InStr(0,".htm")>0 Then //HTML FILE
		      isHTMLFile = True
		    End if
		    
		    if URL.InStr("file://")>0 Then
		       isFileURL=True
		    End If
		    
		    if isPHPFile Or isHTMLFile Then
		      Dim newurl As String
		      Dim pathtmparr(-1) As String
		      Dim newpath As String
		      Dim currentfoldersarray(-1) As String
		      if URL.InStr("://")>0 Then
		        newurl = URL.Mid((URL.InStr(0,"://")+3))
		        if isFileURL=False Then
		          newurl = newurl.Mid((newurl.InStr(0,"/")+1))
		        End If
		      Else
		        newurl=URL
		      End If
		      if isFileURL=False Then
		        pathtmparr=newurl.Split("/")
		      Else
		        
		        Do
		          if newurl.InStr(0,"documents")>0 Then
		            newurl=newurl.Right(newurl.Len-(newurl.InStr(0,"documents")+9))
		          Else
		            Exit Do
		          End If
		        Loop 
		        pathtmparr=newurl.Split("/")
		      End If
		      
		      If pathtmparr.Ubound>0 Then
		        App.filetoprocess=pathtmparr(pathtmparr.Ubound)
		        For Each folder As String In pathtmparr
		          if folder=".." Then
		            currentfoldersarray=App.CurrentDocumentsFolderPath.Split("/")
		            App.CurrentDocumentsFolderPath=App.CurrentDocumentsFolderPath.Replace(currentfoldersarray(currentfoldersarray.Ubound-1)+"/","")
		            currentfoldersarray=Nil
		            Continue
		          End if
		          if folder.InStr(0,"?")>0 And folder.InStr(0,"=")>0 Then
		            Dim urlqueryparts(-1) As String
		            urlqueryparts=folder.Split("?")
		            folder=urlqueryparts(0)
		            App.filetoprocess=urlqueryparts(0)
		            ProcessGETQuery(urlqueryparts(1))
		            urlqueryparts=Nil
		          End if
		          
		          App.CurrentDocumentsFolderPath=Replace(App.CurrentDocumentsFolderPath,folder+"/","")
		          App.CurrentDocumentsFolderPath=Replace(App.CurrentDocumentsFolderPath,"/"+folder,"")
		          App.CurrentDocumentsFolderPath=Replace(App.CurrentDocumentsFolderPath,folder,"")
		          if folder<>App.filetoprocess Then newpath=newpath+folder+"/"
		        Next
		        App.CurrentDocumentsFolderPath=App.CurrentDocumentsFolderPath+newpath
		      Else
		        App.filetoprocess=newurl
		      End if
		      f = New FolderItem(App.CurrentDocumentsFolderPath+App.filetoprocess)
		      fullpath = f.UnixpathMBS
		      
		      f=Nil
		      f = GetFolderItem(fullpath, FolderItem.PathTypeShell)
		      If f <> Nil And f.Exists=True then
		        loadhtml=true
		      ElseIf f.Exists=False Then
		        HTMLViewer1.LoadHTMLStringMBS("<b>File &quot;"+newurl+"&quot; Not Found</b>","")
		        return
		      End if
		    Else
		      f = New FolderItem("documents/index.php")
		      fullpath = f.UnixpathMBS
		      f=Nil
		      f = GetFolderItem(fullpath, FolderItem.PathTypeShell)
		      If f <> Nil And f.Exists=True Then
		        loadhtml=true
		        isPHPFile = True //default index.php file
		      ElseIf f.Exists=False Then
		        HTMLViewer1.LoadHTMLStringMBS("<b>Error loading Index.php. File Not Found.</b>","")
		        return
		      End if
		      
		    End if
		    
		    If loadhtml = True Then
		      t=f.OpenAsTextFile
		      t.Encoding= Encodings.MacRoman
		      if isPHPFile Then
		        App.HTMLCode = p.Execute(PHPGetSets+"?>"+t.ReadAll)
		      ElseIf isHTMLFile Then
		        App.HTMLCode = t.ReadAll
		      End if
		      
		      //Replacing Onclick to contain javascript callback
		      If rex.Compile(hrefsearchpattern.Text) = True Then
		        App.HTMLCode=rex.ReplaceAll(App.HTMLCode,hrefreplacehpattern.Text)
		      End If
		      
		      //Replacing href by onclick to have javascript callback for navigation
		      If rex.Compile(hrefsearchpattern2.Text) = True Then
		        App.HTMLCode=rex.ReplaceAll(App.HTMLCode,hrefreplacehpattern2.Text)
		      End If
		      
		      if fullpath.InStr(0,App.filetoprocess)>0 Then
		        fullpath = "file://"+fullpath
		      Else
		        fullpath="file://"+fullpath+App.filetoprocess
		      End If
		      HTMLViewer1.LoadHTMLStringMBS(App.HTMLCode,fullpath)
		      
		      t.Close
		    Else
		      MsgBox "Error loading php result."
		    End If
		    f=Nil
		    t=Nil
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ProcessGETQuery(GetQueryString As String)
		  If GetQueryString<>"" Then
		    Dim GetQueryStringParts(-1) As String
		    Dim PHPVarName As String
		    Dim PHPVarValue As Variant
		    PHPGetSets=""
		    GetQueryStringParts=GetQueryString.Split("&")
		    For Each item As String In GetQueryStringParts
		      PHPVarName=item.Left(item.InStr(0,"=")-1)
		      PHPVarValue=item.Right((item.Len-PHPVarName.Len-1))
		      if PHPVarValue.IsNumeric() Then
		        PHPGetSets=PHPGetSets+"$_GET["""+PHPVarName+"""]="+PHPVarValue+";"+Chr(10)
		        PHPGetSets=PHPGetSets+"$_REQUEST["""+PHPVarName+"""]="+PHPVarValue+";"+Chr(10)
		      Else
		        PHPGetSets=PHPGetSets+"$_GET["""+PHPVarName+"""]=urldecode("""+PHPVarValue+""");"+Chr(10)
		        PHPGetSets=PHPGetSets+"$_REQUEST["""+PHPVarName+"""]=urldecode("""+PHPVarValue+""");"+Chr(10)
		      End If
		    Next
		  End If
		End Sub
	#tag EndMethod


	#tag Property, Flags = &h0
		htmlEvents As MyFrameEvents
	#tag EndProperty

	#tag Property, Flags = &h0
		p As PHPMBS
	#tag EndProperty

	#tag Property, Flags = &h0
		PHPGetSets As String
	#tag EndProperty

	#tag Property, Flags = &h0
		rex As RegExMBS
	#tag EndProperty


#tag EndWindowCode

#tag Events HTMLViewer1
	#tag Event
		Sub DocumentComplete(url as String)
		  App.HTMLResultLoaded = False
		  Window1.Title = "Pe8Pe Browser v0.1 - "+App.httpWindowTitle
		  
		  //onclick.setValue("onclick","Pe8PeCall.navigate("""+TheHREF+""");")
		End Sub
	#tag EndEvent
	#tag Event
		Sub DocumentProgressChanged(URL as String, percentageComplete as Integer)
		  Window1.Title = "Loading "+App.CurrentDocumentsFolderPath+App.filetoprocess+"... "+Str(percentageComplete)+"% Complete"
		End Sub
	#tag EndEvent
	#tag Event
		Sub TitleChanged(newTitle as String)
		  App.httpWindowTitle=newTitle
		End Sub
	#tag EndEvent
	#tag Event
		Sub DocumentBegin(url as String)
		  LoadPHPCode(URL)
		End Sub
	#tag EndEvent
#tag EndEvents
#tag ViewBehavior
	#tag ViewProperty
		Name="MinimumWidth"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MinimumHeight"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumWidth"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumHeight"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Type"
		Visible=true
		Group="Frame"
		InitialValue="0"
		Type="Types"
		EditorType="Enum"
		#tag EnumValues
			"0 - Document"
			"1 - Movable Modal"
			"2 - Modal Dialog"
			"3 - Floating Window"
			"4 - Plain Box"
			"5 - Shadowed Box"
			"6 - Rounded Window"
			"7 - Global Floating Window"
			"8 - Sheet Window"
			"9 - Metal Window"
			"11 - Modeless Dialog"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasCloseButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMaximizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMinimizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasFullScreenButton"
		Visible=true
		Group="Frame"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="DefaultLocation"
		Visible=true
		Group="Behavior"
		InitialValue="0"
		Type="Locations"
		EditorType="Enum"
		#tag EnumValues
			"0 - Default"
			"1 - Parent Window"
			"2 - Main Screen"
			"3 - Parent Window Screen"
			"4 - Stagger"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasBackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="BackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="&hFFFFFF"
		Type="Color"
		EditorType="Color"
	#tag EndViewProperty
	#tag ViewProperty
		Name="Name"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Interfaces"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Super"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Width"
		Visible=true
		Group="Position"
		InitialValue="300"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Height"
		Visible=true
		Group="Position"
		InitialValue="300"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Composite"
		Visible=true
		Group="Appearance"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Backdrop"
		Visible=true
		Group="Appearance"
		InitialValue=""
		Type="Picture"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Title"
		Visible=true
		Group="Appearance"
		InitialValue="Untitled"
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Visible"
		Visible=true
		Group="Appearance"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="FullScreen"
		Visible=true
		Group="Appearance"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBarVisible"
		Visible=true
		Group="Appearance"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Resizeable"
		Visible=true
		Group="Appearance"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MacProcID"
		Visible=true
		Group="Appearance"
		InitialValue="0"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBar"
		Visible=true
		Group="Appearance"
		InitialValue=""
		Type="MenuBar"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="ImplicitInstance"
		Visible=true
		Group="Appearance"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="PHPGetSets"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="String"
		EditorType="MultiLineEditor"
	#tag EndViewProperty
#tag EndViewBehavior
